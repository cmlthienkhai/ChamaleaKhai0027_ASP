@{
    ViewBag.Title = "Product";
}
<style>
    .price-wrap1 {
        text-align: left;
    }
   
        .card-product-grid .info-wrap {
            flex: 2; /* Phần mô tả chiếm nhiều không gian hơn */
            overflow: hidden; /* Ẩn phần mô tả dài */
        }

            .card-product-grid .info-wrap p {
                margin: 0;
                text-overflow: ellipsis; /* Hiển thị dấu ba chấm nếu mô tả quá dài */
                white-space: nowrap; /* Không gói dòng */
                overflow: hidden; /* Ẩn phần văn bản vượt quá khung */
            }

</style>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function () {
    // Handle adding product to cart when form is submitted
    $('.add-to-cart-form').on('submit', function (event) {
        event.preventDefault(); // Prevent form from submitting the traditional way

        var $form = $(this); // Get the current form object
        var $message = $form.siblings('.product-message'); // Get the message for the current product

        $.ajax({
            url: $form.attr('action'),
            type: 'POST',
            data: $form.serialize(),
            success: function (response) {
                console.log('Add to Cart response:', response); // Check the response

                // Show message when product is successfully added to cart
                $message.text('Product has been added to the cart!').show();

                // Optional: Hide the message after a delay
                setTimeout(function () {
                    $message.fadeOut();
                }, 3000);

                // Update the cart item count
                if (response.CartCount > 0) {
                    $('.notify').text(response.CartCount).show(); // Update and show the count
                } else {

                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.error('Error:', textStatus, errorThrown); // Check for errors
                $message.text('An error occurred. Please try again.').show();

                // Optional: Hide the message after a delay
                setTimeout(function () {
                    $message.fadeOut();
                }, 3000);
            }
        });
    });

    // Update profile notification count if needed
    $.ajax({
        url: '@Url.Action("Index", "Profile")', // Replace with appropriate URL and controller/action
        type: 'GET',
        success: function (response) {
            console.log('Profile Notifications response:', response); // Check the response

            if (response.ProfileNotifications > 0) {
                $('.notify-profile').text(response.ProfileNotifications).show(); // Update and show the count
            } else {

            }
        },
        error: function (jqXHR, textStatus, errorThrown) {
            console.error('Error:', textStatus, errorThrown); // Check for errors
        }
    });

    $.ajax({
        url: '@Url.Action("Index", "Cart")',
        type: 'GET',
        success: function (response) {
            if (response.Count > 0) {
                $('.notify-cart').text(response.Count).show(); // Update and show the count
            } else {
            }
        },
        error: function () {
            console.error("Error retrieving cart item count");
        }
    });


});
</script>
<body>
    <!-- ========================= SECTION CONTENT ========================= -->
    <section class="section-content padding-y">
        <div class="container">

            <!-- ============================ FILTER TOP END.// ================================= -->

            <header class="mb-3">
                <div class="form-inline">
                    <strong class="mr-md-auto">@Model.Count() Items found</strong>                    <select class="mr-2 form-control">
                        <option>Latest items</option>
                        <option>Trending</option>
                        <option>Most Popular</option>
                        <option>Cheapest</option>
                    </select>
                    <div class="btn-group">
                        <a href="@Url.Action("Index", "Product")" class="btn btn-light active" data-toggle="tooltip" title="List view">
                            <i class="fa fa-bars"></i>
                        </a>
                        <a href="#" class="btn btn-light" data-toggle="tooltip" title="Grid view">
                            <i class="fa fa-th"></i>
                        </a>
                    </div>
                </div>
            </header><!-- sect-heading -->

            @model IEnumerable<ChamaleaKhai0027.Context.Product>

            <div class="row">
                @foreach (var product in Model)
                {
                    <div class="col-md-3">
                        <figure class="card card-product-grid">
                            <div class="img-wrap">
                                <a href="@Url.Action("ProductDetail", "Product", new { id = product.Id })" class="img-wrap">
                                    <img src="~/images/pro/@product.ImageUrl" alt="@product.Name" />
                                </a>
                            </div> <!-- img-wrap.// -->
                            <figcaption class="info-wrap">
                                <div>@Html.ActionLink(product.Name, "ProductDetail", "Product", new { id = product.Id }, null)</div>


                                <div class="price-wrap1">
                                    <span class="price h5">Price: @product.Price.ToString("N0")</span>
                                    <small class="text-muted">VND</small>
                                </div> <!-- price-wrap.// -->

                                <p>@product.Description</p>
                                <hr>
                                <form class="add-to-cart-form" method="post" action="@Url.Action("AddToCart", "Cart")">
                                    <input type="hidden" name="productId" value="@product.Id" />
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-shopping-cart"></i>
                                        Add to Cart
                                    </button>
                                </form>

                                <!-- Thông báo dưới sản phẩm -->
                                <div class="alert alert-success product-message mt-2" style="display: none;">
                                    Product has been added to the cart!
                                </div>
                            </figcaption>
                        </figure>
                    </div> <!-- col.// -->
                }


            </div> <!-- row end.// -->


            <nav class="mb-4" aria-label="Page navigation sample">
                <ul class="pagination">
                    <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item"><a class="page-link" href="#">4</a></li>
                    <li class="page-item"><a class="page-link" href="#">5</a></li>
                    <li class="page-item"><a class="page-link" href="#">Next</a></li>
                </ul>
            </nav>


            <div class="box text-center">
                <p>Did you find what you were looking for？</p>
                <a href="" class="btn btn-light">Yes</a>
                <a href="" class="btn btn-light">No</a>
            </div>

        </div> <!-- container .//  -->
    </section>
    <!-- ========================= SECTION CONTENT END// ========================= -->
    <!-- ========================= SECTION SUBSCRIBE  ========================= -->
    <section class="padding-y-lg bg-light border-top">
        <div class="container">

            <p class="pb-2 text-center">Delivering the latest product trends and industry news straight to your inbox</p>

            <div class="row justify-content-md-center">
                <div class="col-lg-4 col-sm-6">
                    <form class="form-row">
                        <div class="col-8">
                            <input class="form-control" placeholder="Your Email" type="email">
                        </div> <!-- col.// -->
                        <div class="col-4">
                            <button type="submit" class="btn btn-block btn-warning"> <i class="fa fa-envelope"></i> Subscribe </button>
                        </div> <!-- col.// -->
                    </form>
                    <small class="form-text">We’ll never share your email address with a third-party. </small>
                </div> <!-- col-md-6.// -->
            </div>


        </div>
    </section>
    <!-- ========================= SECTION SUBSCRIBE END// ========================= -->




